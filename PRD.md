# RecorderPhone（暂定名）PRD（可执行版）

## 1. 背景与问题
用户在 Windows11 PC 与 Android 手机之间频繁切换，真实时间去向分散在应用、窗口与网页 Tab 中；目前靠记忆或零散记录难以复盘，导致：
- 不知道“这 45 分钟到底做了什么/产出是什么”
- 难以发现分心来源（短视频/聊天/频繁切换）
- 难以形成可检索、可导出的工作日志（用于周报/复盘/改进实验）

## 2. 产品定位
跨设备“使用记录 + 周期复盘助手”：自动记录 PC/手机的应用与网页使用情况，按时段提醒你快速补一句“我在做什么/产出/下一步”，并生成可检索的复盘素材。默认隐私优先、最小化采集。

## 3. 目标与非目标
### 3.1 目标（MVP 必须达成）
- G1：自动生成跨设备时间轴（应用/域名维度）与按段（block）汇总
- G2：每 45 分钟（可配置）触发“10 秒复盘”提醒，形成可存档的段总结
- G3：支持导出（Markdown/CSV）到外部笔记/任务系统（先离线导出即可）
- G4：对敏感数据“默认不采集/可控可删可导出”，建立信任，能长期使用

### 3.2 非目标（MVP 不做/后续再做）
- NG1：不做“监控他人/企业监管”功能（产品定位个人复盘）
- NG2：不做全量内容采集（键盘输入、网页正文、截图）作为默认能力
- NG3：不强制上云与账号体系（MVP 先本地单机/局域网可选）
- NG4：不做复杂任务管理（只做“记录与复盘”，任务由用户在外部工具完成）

## 4. 用户与场景
### 4.1 目标用户
- 知识工作者/开发/产品/设计：需要可检索的工作轨迹与周复盘
- 自我管理型用户：关注分心、番茄、深度工作块数量

### 4.2 核心场景（Top 3）
1) 进行一段工作（coding/写文档/开会），45 分钟后收到总结提醒并补充产出
2) 晚上回看“今天做了什么”，快速找回任务脉络（含 PC+手机）
3) 周末复盘：看时间去向、分心触发点，并设置下周改进实验

## 5. 关键体验与用户路径
### 5.1 首次使用（激活路径）
1) 安装 Windows Agent（托盘常驻）→ 选择采集层级（默认 Level 1）
2) 安装 Android App → 引导开启“使用情况访问权限”与通知权限
3) 选择复盘节奏（默认 45 分钟）→ 试运行 1 个 block
4) 在提醒卡片中补一句“产出/下一步”→ 在时间轴看到该段总结（完成首个闭环）

### 5.2 日常使用（核心循环）
记录（自动）→ 分段汇总（自动）→ 提醒（定时/自适应）→ 用户补充一句（可选）→ 生成可检索日志（自动）→ 导出/复盘（偶发）

## 6. 功能需求

### 6.1 MVP 范围（v0.1~v0.3）
#### A. 记录与分段（必做）
- Windows：记录前台应用（进程名/应用名）、窗口标题（可选）、活跃时长、切换次数、空闲时间
- 浏览器（Windows）：记录活跃 Tab 的域名（默认）/标题（可选）/URL（高敏可选）
- Android：记录前台应用包名、活跃时长、切换次数（精度满足“复盘”即可）
- 分段（Focus Block）规则：
  - 默认 45 分钟一段；段内以“活跃活动”为主（空闲超过 X 分钟自动切段，默认 5 分钟）
  - 段内汇总 Top N（默认 5）应用/域名及占比

#### B. 提醒与快速复盘（必做）
- 到点提醒（Windows 通知 + Android 通知），内容包含：
  - “这段时间主要在：Top3 应用/域名 + 时长”
  - 两个快捷输入：`我在做什么（可选）`、`产出/下一步（建议）`
- 支持延后（10/20/30 分钟）与本次跳过

#### C. 时间轴与检索（必做）
- 日视图：按时间轴展示 block 列表；点击进入 block 详情
- block 详情：活动条形图（应用/域名）、你的补充文本、可编辑标签（如“工作/学习/娱乐/会议”）
- 搜索：按关键词（应用名/域名/你写的补充）检索

#### D. 数据控制（必做）
- 黑名单：指定应用/域名永不记录（或记录为“隐藏项”）
- 采集层级开关（见 7. 权限策略）
- 删除与导出：按天/按段删除；导出 Markdown/CSV（本地）

#### E. LLM（MVP 可选：默认关闭）
- “段总结”按钮：把该段聚合数据 + 你的补充，生成 3~5 行日志（在本地编辑后保存）
- 发送到云端前脱敏：默认只发送应用类别与域名（不发 URL/窗口标题）

### 6.2 明确不做（MVP）
- 全量截图/录屏、键盘级记录
- 自动识别网页正文内容
- 团队协作/排行榜/社交

### 6.3 验收标准（MVP 可测试）
- 连续运行 8 小时：Windows Agent CPU 平均 < 1%，内存 < 150MB（含本地库）；Android 日耗电可感知增量 < 5%（中轻度使用）
- 记录准确性：应用前台时长误差在“复盘可用”范围（按段汇总 Top3 正确率主观满意即可）
- 提醒到达率：系统未被强杀/未禁用通知时，提醒到达率 > 95%
- 导出可用：导出 Markdown 后可直接粘贴到常见笔记（Notion/Obsidian/飞书文档等）结构不乱

## 7. 权限与合规策略（渐进式授权）

### 7.1 采集层级（建议 UI 以“隐私级别”表达）
- Level 1（默认，低敏）：应用名 + 活跃时长 + 切换次数 + 空闲（不采集窗口标题/URL）
- Level 2（可选，中敏）：Windows 窗口标题；浏览器 Tab 标题（仍默认仅域名）
- Level 3（可选，高敏）：完整 exePath（进程全路径，用于更准确识别应用/诊断）；（后续可选）完整 URL（仅对白名单域名生效）

### 7.2 Windows 侧权限点
- 常规：无需管理员权限即可读取前台窗口/进程信息（尽量避免触发安全软件误报）
- 开机自启：提供开关与解释（提升记录完整性）
- 浏览器扩展权限（Edge/Chrome MV3）：
  - `tabs`、`activeTab`、（可选）`history`（不建议默认要）
  - Host 权限建议最小化：仅 `http://localhost:*/*`（用于发数据到本机 Agent）+ 可选 `*://*/*`（仅当要读 URL；默认不启用）
- 解释文案策略：先讲收益（段总结/找回工作脉络）→ 再讲采集范围（只记录域名/时长）→ 再给开关（随时暂停/黑名单/本地存储）

### 7.3 Android 侧权限点（MVP）
- `PACKAGE_USAGE_STATS`（使用情况访问）：核心，用于获取前台应用与时长
- `POST_NOTIFICATIONS`（Android 13+）：用于复盘提醒
-（尽量避免）`SCHEDULE_EXACT_ALARM`：除非明确需要“到秒级准时”；优先 WorkManager + 允许误差的提醒
- 电池优化白名单引导：仅在用户遇到“提醒不到/记录断档”时再提示开启（避免首次即高压引导）

## 8. 竞品与差异化（典型参考）
> 竞品能力会随版本变化，这里只对“常见形态”做对比，便于明确定位。

| 类别 | 代表产品 | 常见强项 | 常见短板 | 我们的差异化 |
|---|---|---|---|---|
| PC 追踪（商业） | RescueTime / Rize 等 | 稳定追踪、报表、分心阻断 | 隐私顾虑、跨设备融合有限、复盘输入弱 | “复盘闭环”是核心：到点总结 + 10 秒产出记录 |
| Mac 专精 | Timing 等 | macOS 深度集成 | 不覆盖 Windows/Android | 主打 Windows11 + Android 双端 |
| 开源自托管 | ActivityWatch | 可控、可扩展 | 需要折腾、复盘产品化弱 | 开源式隐私理念 + 商用品质体验（默认可用） |
| 系统自带 | Android Digital Wellbeing / Windows Focus | 轻量、无需安装 | 只看统计，难形成可检索工作日志 | 从“统计”升级为“可导出的工作日志/复盘素材” |

## 9. 数据与架构（MVP 推荐：本地优先）

### 9.1 数据模型（简化）
- `raw_event`：时间戳、设备、来源（app/window/tab/idle）、标识（app_id/domain）、可选标题、持续时长
- `block`：block_id、start/end、top_items（聚合）、user_note、tags、quality_score（可选）
- `setting`：采集层级、黑名单、提醒间隔、脱敏策略

### 9.2 分段算法（MVP 可落地）
- 以“活跃事件流”按时间顺序聚合
- 规则：
  - 空闲 ≥ 5 分钟：结束当前 block
  - 连续活跃到达 45 分钟：触发复盘提醒（可选择结束 block 或继续累计到 90 分钟再提醒）
  - 高频切换（例如 5 分钟内切换 > N 次）可标记“碎片化”用于提示

### 9.3 同步策略（MVP）
- v0.x：不做账号；本机本地库 + 导出
- v0.3 可选：PC 与手机同一局域网 P2P 同步（二维码配对；仅传聚合 block，不传 raw 高敏字段）
- 后续：端到端加密云同步（非 MVP）

## 10. 埋点与指标

### 10.1 北极星指标（North Star）
- NS1：每周“有效复盘块数”（有效 = 用户填写了产出/下一步 或 手动标记有价值）

### 10.2 漏斗指标（Activation）
- A1：安装后 24h 内完成双端授权比例（Windows 常驻 + Android Usage Access + 通知）
- A2：首次生成 block 并完成一次复盘输入的比例

### 10.3 过程指标（Usage/Quality）
- U1：日活跃天数（至少产生 3 个 block）
- U2：提醒到达率、点击率、填写率、延后率、跳过率
- U3：记录覆盖率（活跃时长中可归因比例；“未知/隐藏”占比）
- U4：碎片化指数（切换频次、短停留比例），以及用户对提示的采纳率（例如是否调整黑名单/改间隔）

### 10.4 留存指标（Retention）
- R1：D7/D30 留存（至少 1 次打开时间轴或导出）
- R2：连续 4 周使用（每周有效复盘块数≥阈值）

### 10.5 关键埋点（事件清单，MVP）
- `app_install`（平台、版本、渠道）
- `permission_grant`（平台、权限名、同意/拒绝、触发场景）
- `tracking_start/stop`（原因：用户暂停/系统限制/崩溃恢复）
- `block_created`（来源：到时/空闲切段/手动）
- `summary_notification_sent/received/clicked`（平台）
- `block_note_saved`（字数、是否包含“产出/下一步”字段）
- `blacklist_add/remove`（类型：app/domain）
- `export_done`（格式、是否包含笔记）
- `llm_summary_generate`（开关状态、脱敏级别、耗时、用户是否编辑后保存）

## 11. 里程碑（建议 6~8 周可出 MVP）

### M0（第 0 周）：需求冻结与原型
- 交互原型：时间轴、block 详情、提醒卡片、隐私层级设置
- 数据字段冻结（raw_event/block/setting）

### M1（第 1~2 周）：Windows Agent（无浏览器扩展）
- 托盘常驻 + 前台应用/空闲检测 + SQLite 落库
- 时间轴（本机）与 block 聚合、导出 CSV/Markdown（基础模板）

### M2（第 3 周）：Android 采集 + 提醒
- UsageStats 采集 + Room 落库 + 45 分钟提醒（WorkManager）
- block 详情与补充输入（最小 UI）

### M3（第 4~5 周）：浏览器 Tab（可选但强价值）
- Edge/Chrome 扩展：活跃 tab 域名/标题上报到本机 Agent
- Windows 侧与 app/window 事件合并，出“域名维度”汇总

### M4（第 6 周）：打磨与可靠性
- 黑名单、暂停记录、权限引导、崩溃恢复
- 性能/耗电压测、数据修复工具（例如重建聚合）

### M5（第 7~8 周，可选）：LLM 段总结（默认关闭）
- 端侧脱敏、总结模板、编辑后保存

## 12. 风险与对策
- 权限敏感导致流失：默认 Level 1 + 渐进式引导；先给价值再要权限
- Android 后台限制导致提醒不到：WorkManager 优先；必要时提供电池优化引导与“健康检查”
- 安全软件/公司电脑策略：Windows 端尽量不要求管理员权限；提供“企业环境兼容模式”（只采应用名/不采窗口标题/不装扩展）
- 数据爆炸与性能：raw_event 做抽样/合并（例如 1~5 秒粒度合并），聚合表为主展示

## 13. 最小可行技术选型清单（Windows Agent + Android 采集）

### 13.1 Windows11（MVP 推荐）
- UI：`Flutter`（Windows/Android 共用一套 UI；Windows 端提供托盘与单实例）
- Core：`Rust` 本机服务（`recorder_core`，Axum + SQLite），监听 `localhost` HTTP
- Windows 采集器：极小 `Rust` exe（`windows_collector`），只做 Win32/系统采集 → POST 到 Core
  - 前台窗口/进程：`GetForegroundWindow` / `GetWindowText`（可选标题）
  - 进程信息：`GetWindowThreadProcessId` + `OpenProcess` / `QueryFullProcessImageName`
  - 空闲：`GetLastInputInfo`
  - 后台音频 App（可选）：Windows CoreAudio sessions（用于“后台播放也算 Now”）
- 数据库：`SQLite`（Core 内 `rusqlite` bundled）
- 通知：Windows Toast（采集器 best-effort 发 toast；点击通过自定义 `recorderphone://` 深链回到 UI）
- 打包/更新：便携目录（Portable zip）+ GitHub Actions tag 发布（无需安装器；后续再考虑自动更新/签名）

### 13.2 浏览器扩展（Edge/Chrome，MVP 可选但建议做）
- 标准：Manifest V3
- 采集：`tabs.onActivated`、`windows.onFocusChanged`、`tabs.query({active:true})`
- 脱敏：默认只取 `hostname`（域名）；标题/URL 走 Level 2/3 开关
- 上报通道：
  - 简化方案：`fetch("http://127.0.0.1:PORT/event")`（Agent 本机监听）
  - 更严格方案：Native Messaging（配置成本更高，放后续）

### 13.3 Android（MVP 推荐）
- 语言/框架：Kotlin + Jetpack（UI 可用 Compose；MVP 可先 Activity + XML）
- 采集：`UsageStatsManager` + `UsageEvents`（读前台 app 事件流）
- 本地存储：Room（SQLite）
- 后台任务：WorkManager（周期聚合 + 触发提醒）；通知用 `NotificationCompat`
- 权限：
  - Usage Access：引导到系统设置页面开启
  - 通知权限：Android 13+ 运行时申请
- 省电策略：默认不强推电池白名单；提供“记录健康检查”页提示用户按需开启

### 13.4 LLM（MVP 可选）
- 先规则模板：按 Top 应用/域名 + 用户补充生成段日志（无需模型）
- 云端模型接入（可选）：仅发送脱敏后的聚合数据；支持“完全关闭”
- 本地模型（后续）：Windows 可考虑小模型离线总结（非 MVP）
